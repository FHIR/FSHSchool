---
title: "Migrating from Older Versions"
weight: 30
---

## Migrating from pre-1.0.0 Projects

The SUSHI project structure and configuration changed significantly between pre-1.0.0 versions of SUSHI and versions of SUSHI 1.0.0 or greater. This guide will assume you currently have a project structure similar to the **customized ig** shown in the [project structure documentation](/docs/sushi/project/#ig-projects) for pre-1.0.0 versions of SUSHI.

To migrate your project, follow these steps:

### 0 - Create a Backup

Before beginning the migration, **make a copy of your entire project directory structure**, and keep it in a safe place.

### 1 - Run SUSHI 0.x
Before making any changes, run a pre-1.0 version of SUSHI. This will generate files you need for the migration.

If you have already upgraded to SUSHI 1.0 or higher, you can revert to a pre-1.0 SUSHI version by issuing the following command:

```
npm install -g fsh-sushi@0.16.0
```
After completing the migration, you can return to the current version of SUSHI by running:

```
npm install -g fsh-sushi
```

### 2 - Update the IG Control Files

Open **./SUSHI-GENERATED-FILES.md**, and look for files that have been generated (in the `ACTION` column).

**2.1** - If they are listed as generated, delete these files:

  **./input/includes/menu.xml**

  **./input/ImplementationGuide-xxxx.json**

  where `ImplementationGuide-xxxx` is the name of your ImplementationGuide resource.

**2.2** - Edit the **./package-list.json** and remove the "DO NOT EDIT THIS FILE" comment block. This file will not longer be generated by SUSHI.

**2.3** - Edit the **./ig.ini** file as follows:

* Remove the "DO NOT EDIT THIS FILE" comment block. The `ig.ini` file will no longer be generated by SUSHI. Be sure not to delete the first line, `[IG]`. 

* Change the ig parameter as follows:
  ```
  ig = fsh-generated/resources/ImplementationGuide-xxxx.json
  ```
  where `ImplementationGuide-xxxx` is the name of your ImplementationGuide resource.

* Update the template parameter to any template based on `fhir.base.template#current`. Older templates will not work with SUSHI 1.x. Any of the following should work:

  * `template = fhir.base.template#current`
  * `template = hl7.base.template#current`
  * `template = hl7.fhir.template#current`
  * `template = hl7.davinci.template#current`
  * `template = hl7.cda.template#current`

  Here is an example of how the ig.ini file might look after your edits:
  ```
  [IG]
  ig = fsh-generated/resources/ImplementationGuide-hl7.fhir.us.mcode.json
  template = hl7.fhir.template#current
  ```

**2.4** - Delete the file **./SUSHI-GENERATED-FILES.md**. In SUSHI 1.0, all generated files are found in the directory, **./fsh-generated**, making it much easier to distinguish SUSHI inputs and outputs.

### 3 - Update the SUSHI Control File

**3.1** - Move the **fsh/config.yaml** file to the top-level folder, and rename it **sushi-config.yaml**.

**3.2** - Edit **sushi-config.yaml**:
* Remove the `template` property if present. The template has been specified in the **ig.ini** file.
* Remove the `history` property if present. The `history` property is replaced by the **package-list.json** file.

### 4 - Move Your .fsh Files

**4.1** - Create a new directory, **./input/fsh**

**4.2** - Move all **.fsh** files in the **./fsh** folder to the new folder, **./input/fsh**.

**4.3** - Check that all the files in **./fsh/ig-data/input/images** have been copied to **./input/images**. Likewise, make sure the contents of **./fsh/ig-data/input/pagecontent** are found in **./input/pagecontent**. This should have already happened as a result of running SUSHI at Step 1, but if any files are missing, copy them to the new locations.

> NOTE: If you prefixed your pages with numbers (1_, 2_, 3_, ...) these numbers will not appear in **./input/pagecontent**. This is expected, and no action is required.

**4.3** - Delete the entire **./fsh** directory and all its contents, including the **/ig-data** subdirectory.

### 5 - Update .gitignore
If you are using Git for version control, update your **.gitignore** file. 

**5.1** - Remove entries for **ig.ini**, **package-list.json**, and the **input** directory, if present. These two files and the entire **./input** folder should now be under source code control.

**5.2** - Add **./fsh-generated** to .gitignore. This is where SUSHI 1.x puts all generated files. Typically, only the original source files are put under source code control. 

Here is a typical example of **.gitignore**:

```
.DS_Store
Thumbs.db
fsh-generated**
input-cache**
output**
template**
temp**
```

### Troubleshooting

Some users may experience one of these issues when running the IG Publisher on their migrated project:
* the IG publisher reports `No Source directories to scan found`
* the published IG does not include any of the resources from **fsh-generated**

This usually means that the IG Publisher is not using the correct template.  _First_, check to ensure your your **ig.ini** specifies the `#current` version of one of the supported templates (or a template that extends one of the supported templates)..

If you've confirmed you are using a `#current` version of a supported template, then the IG Publisher likely failed to download the updated template in your FHIR cache.  This may be due to corporate firewalls, network issues, or restrictive file permissions in your FHIR cache.  Sometimes, you can resolve this issue by deleting the base template from your FHIR cache:

&nbsp;&nbsp;&nbsp;&nbsp;{{< windows >}} `C:\Users\{user}\.fhir\packages\fhir.base.template#current`

&nbsp;&nbsp;&nbsp;&nbsp;{{< apple >}} `/Users/{user}/.fhir/packages/fhir.base.template#current`

substituting `{user}` with your username on your operating system.

{{% alert title="Note" color="primary" %}}
If there is a general problem with downloading the template (as opposed to overwriting it), deleting the template will not fix it. Instead the problem will just become more obvious. If this is the case, you may need to disconnect from your VPN (if applicable) and try again or contact your network administrator for assistance.

For this reason, you may choose to temporarily _move_ your **fhir.base.template#current** folder rather than _deleting_ it.  This way, if the new template still fails to download, you can move the old template back and continue using it for other IGs (for which the new template may not be necessary).
{{% /alert %}}
